<div class="booking-system">
  <header class="header">
    <h1>üéØ –°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h1>
    <div class="current-time">
      <span>–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: {{ currentTime() }}</span>
    </div>
  </header>

  <main class="main-content">
    <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
    <section class="calendar-section">
      <h2>üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</h2>
      <div class="calendar">
        @for (day of calendarDays; track day) {
          <button 
            class="day-btn"
            [class.today]="isToday(day)"
            [class.selected]="isSelected(day)"
            (click)="selectDate(day)"
          >
            <div class="day-week">{{ formatDate(day) }}</div>
            <div class="day-availability">
              @if (bookingService.getSlotsByDate(day).some(s => s.available)) {
                <span class="available">–ï—Å—Ç—å –º–µ—Å—Ç–∞</span>
              } @else {
                <span class="unavailable">–ù–µ—Ç –º–µ—Å—Ç</span>
              }
            </div>
          </button>
        }
      </div>
    </section>

    <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–ª–æ—Ç—ã -->
    <section class="time-section">
      <h2>‚è∞ –í—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</h2>
      
      @if (getTimeSlotsForSelectedDate().length === 0) {
        <p class="no-slots">–ù–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤</p>
      } @else {
        <div class="time-slots">
          @for (time of getTimeSlotsForSelectedDate(); track time) {
            <button 
              class="time-btn"
              [class.selected]="selectedSlot()?.time === time"
              [class.available]="isTimeAvailable(selectedDate, time)"
              [class.unavailable]="!isTimeAvailable(selectedDate, time)"
              (click)="selectTime(time)"
              [disabled]="!isTimeAvailable(selectedDate, time)"
            >
              <span class="time">{{ time }}</span>
              <span class="price">{{ getPriceForTime(time) }} ‚ÇΩ</span>
              @if (!isTimeAvailable(selectedDate, time)) {
                <span class="booked">–ó–∞–Ω—è—Ç–æ</span>
              }
            </button>
          }
        </div>
      }
    </section>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—ã–±–æ—Ä–µ -->
    <section class="info-section">
      <div class="selected-info">
        @if (selectedSlot()) {
          <h2>‚úÖ –í—ã –≤—ã–±—Ä–∞–ª–∏:</h2>
          <div class="selection-details">
            <p><strong>–î–∞—Ç–∞:</strong> {{ formatDate(selectedDate) }}</p>
            <p><strong>–í—Ä–µ–º—è:</strong> {{ selectedSlot()?.time }}</p>
            <p><strong>–ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞:</strong> {{ selectedSlot()?.price }} ‚ÇΩ</p>
            
            <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ -->
            <div class="dynamic-pricing">
              <h3>üìä –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ:</h3>
              <ul>
                @if (selectedDate.getDay() === 5 || selectedDate.getDay() === 6) {
                  <li>+30% –∑–∞ –≤—ã—Ö–æ–¥–Ω—ã–µ</li>
                }
                @if (parseInt(selectedSlot()?.time?.split(':')[0] || '0') < 12) {
                  <li>-10% –∑–∞ —É—Ç—Ä–µ–Ω–Ω–∏–µ —á–∞—Å—ã</li>
                }
              </ul>
            </div>
            
            <div class="final-price">
              <h3>–ò—Ç–æ–≥–æ–≤–∞—è —Ü–µ–Ω–∞: {{ totalPrice() }} ‚ÇΩ</h3>
            </div>
          </div>
        } @else {
          <p>–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</p>
        }
      </div>
    </section>

    <!-- –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <section class="booking-form">
      <h2>üìù –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</h2>
      
      @if (selectedSlot()) {
        <div class="form">
          <div class="form-group">
            <label for="name">–í–∞—à–µ –∏–º—è:</label>
            <input 
              type="text" 
              id="name" 
              [(ngModel)]="bookingName"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"
              [disabled]="!selectedSlot()?.available"
            >
          </div>
          
          <div class="form-group">
            <label>–°—Ç–∞—Ç—É—Å:</label>
            @if (selectedSlot()?.available) {
              <span class="status available">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</span>
            } @else {
              <span class="status unavailable">–ó–∞–Ω—è—Ç–æ</span>
              @if (selectedSlot()?.bookedBy) {
                <p>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–æ: {{ selectedSlot()?.bookedBy }}</p>
              }
            }
          </div>
          
          <button 
            class="book-btn"
            (click)="book()"
            [disabled]="!selectedSlot()?.available || !bookingName.trim() || isBooking"
          >
            @if (isBooking) {
              <span class="loading">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ...</span>
            } @else {
              <span>–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∑–∞ {{ totalPrice() }} ‚ÇΩ</span>
            }
          </button>
          
          @if (selectedSlot()?.bookedBy && !selectedSlot()?.available) {
            <button 
              class="cancel-btn"
              (click)="cancelBooking(selectedSlot()!.id)"
            >
              –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
            </button>
          }
        </div>
      } @else {
        <p>–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Ä–µ–º—è</p>
      }
      
      @if (bookingResult) {
        <div class="result-message">
          {{ bookingResult }}
        </div>
      }
    </section>

    <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã (—Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–π —Å–ø–∏—Å–æ–∫) -->
    <section class="available-slots">
      <h2>üìã –î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–ª–æ—Ç—ã –Ω–∞ {{ formatDate(selectedDate) }}</h2>
      
      @if (availableSlots().length === 0) {
        <p>–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—É—é –¥–∞—Ç—É</p>
      } @else {
        <div class="slots-list">
          @for (slot of availableSlots(); track slot.id) {
            <div class="slot-item">
              <div class="slot-time">{{ slot.time }}</div>
              <div class="slot-price">{{ slot.price }} ‚ÇΩ</div>
              <div class="slot-status available">–î–æ—Å—Ç—É–ø–Ω–æ</div>
            </div>
          }
        </div>
      }
    </section>

    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ -->
    <section class="system-info">
      <h2>‚ÑπÔ∏è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–∏—Å—Ç–µ–º–µ</h2>
      <div class="info-grid">
        <div class="info-item">
          <h3>–†–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å</h3>
          <p>–î–∞—Ç—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        <div class="info-item">
          <h3>–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏</h3>
          <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å–ª–æ—Ç–æ–≤</p>
        </div>
        <div class="info-item">
          <h3>–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
          <p>–¶–µ–Ω–∞ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∏</p>
        </div>
        <div class="info-item">
          <h3>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</h3>
          <p>–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="footer">
    <p>–†–µ–∞–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è &copy; 2024</p>
    <p>–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ ‚Ä¢ –°–∏–≥–Ω–∞–ª—ã ‚Ä¢ RxJS</p>
  </footer>
</div>